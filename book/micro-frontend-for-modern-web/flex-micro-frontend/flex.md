# flex 팀의 전환기

마이크로프론트엔드 도입에 있어서 정말 얼마 없는 양질의 한글 레퍼런스이다..

플렉스 제품의 문제만 간략하게 인식해보면 쉬운데

기존의 경우에는 인프라 레벨에서 여러가지 next.js 앱들을 라우팅해주는 형태였다.

예컨대 flex/time 으로 접속하면 그에 해당하는 next.js 앱이

flex/digicon 으로 접속하면 그에 해당하는 next.js 앱이 라우팅되는 형식이다.

이렇게 인프라레벨에서 라우팅을 수행하게되면 SPA 처럼 동작하는 것은 불가능해진다.

각 앱마다 모두 html, css, 자바스크립트 번들을 처음부터 다시 받아와야하기떄문이다.

# 어떻게 해결?

모듈 번들러 웹팩은 "모듈 페더레이션" 이라는 기법을 지원한다.

스터디 때 준서님에게 간단하게 설명을 들었던 내용인데 마이크로프론트엔드의 구현 방식으로 사용할 수 있다.

하나의 앱을 독립적으로 배포 가능한 모듈 단위로 나눈뒤 브라우저의 런타임 시점에 통합하는 방식을 사용하는 것이다.

이 모듈 페더레이션의 핵심은 "빌드 타임" 이 아니라 "런타임"에 분리된 앱을 합친다는 것에 있다.

분리된 앱들은 서로 각자만의 개발 프로세스를 거치고 자바스크립트 번들 형태로 배포된다.

그리고 이 마이크로앱들은 호스트라고 불리는 앱에서 번들 형태로 로드되는 것을 통해 각각 따로 렌더링된다.

이런 모듈 페더레이션 기법을 적용하게되면 화면의 모든 UI를 컴포넌트 단위로 배포할 수 있게되는 것이다.

또한 Iframe같은 수단을 사용할 필요도 없고 상태 공유 방법에 대한 고려도 필요없다.

앱 내부에서는 그냥 코드스플리팅을 한 것처럼 자연스럽게 통합할 수 있다.

# 근데 문제가..

next.js에서는 모듈페더레이션을 공식적으로 지원할 계획이 없는 것 처럼 보인다.

오픈소스 커뮤니티가 있긴 하지만 프로덕션에서 쓰기엔 무리로 판단한 것 같다.

# 모듈페더레이션 자체의 리스크


## 전방향적 리스크

하나의 마이크로앱은 다른 앱을 호출할수도, 다른 앱에게 호출당할수도 있다.

다른 앱을 호출하는 마이크로앱을 호스트 / 다른 앱에게 호출당하는 마이크로 앱을 리모트로 한다면

모든 마이크로 앱은 호스트이면서 리모트가 될수 있다는 것이다.

이러한 특성을 "전방향(Omnidirectional)" 적인 특성이라고 부른다.

이렇게 되면 런타임의존성이 복잡해지고 순환의존 문제가 발생할수도 있을 것으로 생각된다.

flex 팀의 경우에는 2depth의 단방향 의존 트리를 구성하는 것을 통해 해결한 것으로 보이는데 타당해보인다.

## 런타임 에러 리스크

모듈 페더레이션은 런타임에 마이크로앱들을 합친다. 

이것은 동적으로 앱이 합쳐지는 과정에서 에러가 발생되면 유저가 앱을 원활히 쓰지 못할 수 있다는 것이다.

따라서 flex 의 경우에는 모든앱이 통합되어 돌아가는 개발환경과 하나의 앱만 돌아가는 개발환경 두가지를 제공하는 것을 통해 이런 런타임 에러를 개발시점에 캐치하고자 한 것 같다.


# 아스트로

https://medium.com/@sergio.a.soria/setting-up-micro-frontends-with-astro-and-ecma-script-modules-137340d2c520

댓글에 누가 아스트로 냅두고 왜 이렇게했을까라는 말과함께 위 링크를 달았는데

아스트로를 이용해 마이크로프론트엔드를 가져와서 통합시키면 쉬운데 왜 저리했냐는 내용인 듯하다.

읽어보니 마이크로프론트엔드의 구현 라이브러리,프레임워크에 구애받지 않기떄문에

그냥 아스트로에서 프레임워크를 통합하기위해 URL 가져오기를 통해서 구현하면 된다는 것 같다.


https://github.com/sasoria/astro-microfrontends

예제 코드도 제공되는데 정말.. 머리가 띵하다.

이렇게 하는게 훨씬 간단해보인다.


# 느낀점

글 자체는 이전에 유튜브에서 본 내용이다보니 새로울게 없었지만

댓글에서 이렇게 인사이트를 얻을 줄은 몰랐다.

리액트 생태계 밖에서는 재밌는 일들이 많이 일어나고있다는 생각이 든다.


# 레퍼런스

https://yozm.wishket.com/magazine/detail/2408/

https://yozm.wishket.com/magazine/detail/2409/

