# prpl 패턴이란?

prpl은 다음의 약어 입니다.

push 가장 중요한 리소스를 푸시 / 사전로드
render / 가능한 빨리 초기 경로를 렌더링
pre-cache / 기존에 저장해둔 자산
lazy load / 중요하지 않은 자산은 지연 로드

이러한 PRPL 아키텍처는 Google Chrome 팀에서 고안했는데요

더 빠른 웹 경험을 위해 수년에 걸쳐 개발된 최적화 트릭이라고 할 수 있으며

이를 위해 서비스 워커 , 백그라운드 동기화, 캐시api , 우선순위 힌트, 프리페치 등을 이용합니다.

PRPL은 오프라인 , 데이터 절약모드, 네트워크 지연이 높은 모바일 기기 등을 위한 패턴입니다.

# P

브라우저가 리소스를 미리 가져와서 브라우저에 저장하도록 지시하는 기법입니다.

리소스가 필요할 때 네트워크를 통해 리소스를 가져오게 되면

느릴 수 밖에 없기 때문에 미리 브라우저가 리소스를 가져오도록 하는 기법입니다.

이러한 기법은 html 을 통해 구현할 수 있는데요 다음과 같이 할 수 있습니다.

```html
<link rel="preload" as="style" href="style.css" />
```

이렇게 rel="preload" 어트리뷰트를 추가하여 사용하는 것을 통해 구현하며

as 애트리뷰트는 사전 로드할 리소스가 어떤 리소스 인지를 명시하는 역할을 합니다.

또한 프리로드와 프리페치는 기본적으로 동일하다는 것도 알아두면 좋습니다.

프리페치는 브라우저가 link 태그의 리소스를 가져와 로컬 캐시에 저장하는 프로세스가 포함되어요

이런 프리페치는 보통 다음 페이지의 탐색을 위해 사용하곤 합니다.

rel="prefetch" 애트리뷰트로 구현할 수 있어요

# R

웹 앱의 초기 경로는 "최대한 빨리" 렌더링 되어야 하며

초기 경로는 "지연 로드"를 해서는 안됩니다.

이것을 Initial Contentful Paint라고 불러요

앱의 목적이 어떤 것이든 브라우저에서 최대한 빠르게 First Paint를 생성해야합니다.

<br/>

이와 관련된 용어로 FCP를 들 수 있습니다.

FCP는 First Contentful Paint의 약자인데요

이 FCP를 최적화 하기 위해서는

1. 렌더링을 차단하는 리소스를 제거하고

2. CSS 전달을 최적화하고

3. SSR을 사용

해야합니다.

리액트에서는 ReactDOMServer를 이용하여 SSR 앱을 빌드할 수 있는데요

사실 직접 리액트돔의 API를 사용하여 빌드하는 것보다는

next.js / remix와 같은 프레임워크를 사용하는 것이 대부분의 개발자에겐 더 익숙할 것입니다.

# P

정적 어셋들이 브라우저에 캐시되어 있다면 어셋에 대한 요청이 있을 때

사용자 경험을 저해하지 않고 캐시에서 바로 어셋을 제공하는 기술이

pre-caching입니다.

이 프리캐싱은 인터넷 연결 상태가 오프라인일 때 아주 유용한데요

네트워크 오류가 표시되는 대신 캐시된 자산이 유저에게 제공되기 때문에 유용합니다.

이러한 프리캐싱은 서비스 워커를 사용하여 수행되며(MSW에서 사용되는 그 기술 맞습니다.)

대부분의 프로그레시브 웹앱에서 사용되는 기술입니다.

<br/>

서비스 워커의 프리캐싱에는 다양한 전략이 존재하는데요

몇몇은 이미 들어본 경험이 있으실 것 같습니다.

1. stale-while-revalidate

캐시에서 응답을 확인해보고 응답이 사용가능한 경우에는 전달하며 캐시의 유효성을 확인합니다.

사용할 수 없는 경우에는 네트워크에서 응답을 가져와서 캐싱합니다.

2. cache first

먼저 캐시에서 응답을 찾아봅니다.

이전에 캐시한 응답이 발견되면 캐시를 반환하고 캐시가 없다면 네트워크 요청을 합니다.

3. Network First

이 전략은 네트워크에서 응답을 가져오려고 합니다.

성공하면 응답을 캐싱하고 응답을 반환합니다.

만약 네트워크가 실패하면 그 뒤에 캐시되어있던 응답을 제공합니다.

4. cache only

이 전략은 캐시에서만 응답을 수행합니다.

5. network only

이 전략은 네트워크만 사용해서 응답을 가져오고 제공합니다.

보통은 리액트쿼리로도 익숙하실 swr 전략을 이용하곤 합니다.

# L

레이지로드는 웹앱의 자산 로드를 연기합니다.

애플리케이션 성능에서 가장 중요한 개념은 응답 시간과 리소스 소비인데요

이것이 발생하는 것은 막을 수 없기 때문에 지연로드를 이용해 성능 문제를 최소화하고자 합니다.

지연로딩은 아래 사항들을 최적화해서 문제의 위험을 최소화시킵니다.

1. response time

지연 로드는 코드를 스플리팅하고 필요한 번들만 로드하기 때문에

응답 시간을 최소화할 수 있습니다.

2. resources consumption

지연 로드는 리소스 로딩량을 줄이기 위해 필요한 코드번들만 로딩합니다.

```html
<img src="./big-image.jpg" loading="lazy" />
```

지연로드 역시 html 태그로 쉽게 구현할 수 있는데요

nextjs의 image 컴포넌트 역시도 쉽게 기능을 제공하고 있습니다.
